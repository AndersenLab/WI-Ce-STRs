theme(legend.position = "none") +
labs(y="Number of sites",
x="STR motif") +
scale_y_continuous(breaks=c(0, 4000,8000), limits = c(0,9000))
###### fig_S4b ######
refSTR_region <- table_s1 %>%
dplyr::group_by(gfeature,motif_length) %>%
dplyr::add_count(name = "STRbyPS_REGION")%>%
dplyr::group_by(gfeature) %>%
dplyr::add_count(name = "STRby_REGION") %>%
dplyr::mutate(ps2region=100*STRbyPS_REGION/STRby_REGION) %>%
dplyr::distinct(gfeature,motif_length,STRbyPS_REGION,STRby_REGION,ps2region) %>%
dplyr::mutate(STRby_REGIONs=ifelse(motif_length==6,STRby_REGION,NA))
refSTR_region$gfeatures<- factor(refSTR_region$gfeature,levels = c("promoter","enhancer","5'UTR","CDS","intron","3'UTR","pseudogene","RNAs & TEs","intergenic"))
#plot
fig_S4b <- ggplot(refSTR_region,aes(x=gfeatures,y=ps2region,fill=factor(motif_length))) +
geom_bar(stat='identity', position = position_stack(reverse = TRUE)) +
coord_flip() +
theme_cust +
xlab("Genomic features")+
ylab("Percent of pSTRs (%)")  +
labs(fill="Motif\nlength")+
scale_fill_manual(values=period_size_color) +
geom_text(aes(label=STRby_REGIONs),y=115,size = 10*5/14)+
scale_y_continuous(breaks=c(0, 50, 100),limits = c(0,125) ) +
theme(legend.position = "left")+
guides(fill = guide_legend(nrow = 6))
###### fig_S4c ######
enrich_refSTR_region_stats <- refSTR_region %>%
dplyr::ungroup() %>%
dplyr::rename(sig_n=STRbyPS_REGION,
sig_total=STRby_REGION) %>%
dplyr::group_by(motif_length) %>%
dplyr::mutate(n=sum(sig_n)) %>%
dplyr::ungroup() %>%
dplyr::mutate(total=sum(sig_n)) %>%
dplyr::group_by(motif_length,gfeature)  %>%
dplyr::do(data.frame(x=fisher_enrich_func(.)))  %>%
dplyr::rename(fisherp = x) %>%
dplyr::ungroup() %>%
dplyr::mutate(fisherp_adj=p.adjust(fisherp,method="bonferroni")) %>%
dplyr::mutate(figure="FIG.S3C")%>%
dplyr::mutate(group_factor="gfeature, motif_length",
group_factor_catogory=paste0(gfeature,  ", ", motif_length),
method="one-sided Fisher's Exact test",
padjustment="BF")
enrich_refSTR_region <- enrich_refSTR_region_stats %>%
dplyr::filter(fisherp_adj<0.05) %>%
dplyr::mutate(logp=-log10(fisherp_adj))  %>%
dplyr::mutate(logp=ifelse(logp=="Inf",400,logp))
enrich_refSTR_region$gfeatures<- factor(enrich_refSTR_region$gfeature,levels = c("promoter","enhancer","5'UTR","CDS","intron","3'UTR","pseudogene","RNAs & TEs","intergenic"))
fig_S4c <- ggplot(enrich_refSTR_region,
aes(y=gfeatures,x=logp,color=factor(motif_length)))+
ggbeeswarm::geom_beeswarm(cex=2,groupOnX = F)+
theme_cust+
theme( legend.position = "none")+
scale_color_manual(values=period_size_color) +
scale_x_continuous(breaks = c(0,100,200,300,400),labels = c("0","100","200","300","Inf")  )   +
ylab("Genomic features")+
xlab(expression(-log[10](italic(p))))
###### fig_S4d ######
enrichMotif_refSTR_region_stats  <-  table_s1 %>%
dplyr::mutate(motif_geno=motif_geno_fwd ) %>%
dplyr::group_by(gfeature, motif_geno ) %>%
dplyr::count(name = "sig_n") %>%
dplyr::ungroup() %>%
dplyr::group_by(gfeature) %>%
dplyr::mutate(sig_total=sum(sig_n)) %>%
dplyr::ungroup() %>%
dplyr::group_by( motif_geno) %>%
dplyr::mutate(n=sum(sig_n)) %>%
dplyr::ungroup() %>%
dplyr::mutate(total=sum(sig_n)) %>%
dplyr::group_by( gfeature,motif_geno )  %>%
dplyr::do(data.frame(x=fisher_enrich_func(.)))  %>%
dplyr::rename(fisherp = x) %>%
dplyr::ungroup() %>%
dplyr::mutate(fisherp_adj=p.adjust(fisherp,method="bonferroni")) %>%
dplyr::mutate(figure="FIG.S3D") %>%
dplyr::mutate(group_factor="gfeature, motif_geno",
group_factor_catogory=paste0(gfeature,  ", ", motif_geno),
method="one-sided Fisher's Exact test",
padjustment="BF")
enrichMotif_refSTR_region <- enrichMotif_refSTR_region_stats %>%
dplyr::filter(fisherp_adj<0.05)   %>%
dplyr::mutate(logp=-log10(fisherp_adj)) %>%
dplyr::mutate(motif_length=nchar(motif_geno))%>%
dplyr::arrange(  motif_length )  %>%
dplyr::group_by(gfeature) %>%
dplyr::top_n(3, logp)
enrichMotif_refSTR_region$gfeatures<- factor(enrichMotif_refSTR_region$gfeature,levels = c("promoter","enhancer","5'UTR","CDS","intron","3'UTR","pseudogene","RNAs & TEs","intergenic"))
fig_S4d <- ggplot(enrichMotif_refSTR_region,
aes(y=gfeatures,x=logp,color=factor(motif_length)))+
ggbeeswarm::geom_beeswarm(cex=2,groupOnX = F) +
ggrepel::geom_text_repel(aes(label = motif_geno),  nudge_x = 3,segment.linetype=6,size=10*5/14,
max.overlaps=Inf,
box.padding = 0.5) +
theme_cust+
theme( legend.position = "none") +
scale_color_manual(values=period_size_color) +
ylab("Genomic features")+
xlab(expression(-log[10](italic(p))))
###### fig S3 #####
fig_S4ab <-  cowplot::plot_grid(fig_S4a, fig_S4b,
labels = c('', 'B'),
rel_widths =  c(1.3,2),
label_size = 12,
label_fontfamily="Helvetica",
axis = "t",
nrow = 1)
fig_S4cd <-  cowplot::plot_grid(fig_S4c,fig_S4d,
labels = c('', 'D'),
label_size = 12,
label_fontfamily="Helvetica",
axis = "t",
nrow = 1)
fig_S4 <-  cowplot::plot_grid(fig_S4ab, fig_S4cd,
labels = c('A', 'C'  ),
label_size = 12,
label_fontfamily="Helvetica",
axis = "lr",
nrow = 2)
ggsave(fig_S4, filename = paste( "../figures/Supp_fig4_refmotif.png",sep = ""), units = "mm",height = 160, width = 170)
############# Figure  S5    ###############
#           motif 134                     #
##########################################
expansion_contractionS_134 <- table_s1_poly %>%
dplyr::filter(!grepl("/",motif_geno)) %>%
dplyr::mutate(motif_geno=motif_geno_fwd ) %>%
dplyr::select(ref_STR ,expansion_score,contraction_score,motif_length,motif_geno) %>%
tidyr::gather(diff,score,-ref_STR,-motif_length,-motif_geno) %>%
dplyr::filter(motif_length %in% c(1,3,4)) %>%
dplyr::mutate(diff=ifelse(score==0,"substitution",diff)) %>%
dplyr::group_by(motif_geno,diff,motif_length) %>%
dplyr::count()  %>%
dplyr::group_by(motif_geno) %>%
dplyr::mutate(count_motif=sum(n)) %>%
dplyr::mutate(frac=100*n/count_motif) %>%
dplyr::mutate(diff=sub("(.*)(_score)","\\1",diff)) %>%
dplyr::group_by(motif_geno) %>%
dplyr::mutate(id=row_number(),
count_motif2=ifelse(id==1,count_motif,NA))
fig_S5a <- ggplot(subset(expansion_contractionS_134,motif_length==1),aes(x=motif_geno,y=frac,fill=factor(diff))) +
geom_bar(stat='identity', position = position_stack(reverse = TRUE)) +
theme_cust +
facet_wrap(.~motif_length,scales = "free") +
coord_flip() +
scale_fill_manual(values=c("#E7B800", "#00AFBB","gray69")) +
xlab("Motif")+
ylab("Percent of\nALT alleles (%)")  +
labs(fill="Mutations") +
geom_text(aes(label=count_motif2),y=109,size = 10*5/14) +
scale_y_continuous(breaks=c(0, 50, 100),limits = c(0,113) ) +
theme(legend.position = "none",
axis.text.x = element_blank(),
axis.title.x = element_blank())
fig_S5b <- ggplot(subset(expansion_contractionS_134,motif_length==3),aes(x=motif_geno,y=frac,fill=factor(diff))) +
geom_bar(stat='identity', position = position_stack(reverse = TRUE)) +
theme_cust +
facet_wrap(.~motif_length,scales = "free") +
coord_flip() +
scale_fill_manual(values=c("#E7B800", "#00AFBB","gray69")) +
xlab("Motif")+
ylab("Percent of\nALT alleles (%)")  +
labs(fill="Mutations") +
geom_text(aes(label=count_motif2),y=109,size = 10*5/14) +
scale_y_continuous(breaks=c(0, 50, 100),limits = c(0,113) ) +
theme(legend.position = "bottom")+
guides(fill = guide_legend(nrow = 3))
fig_S5c <- ggplot(subset(expansion_contractionS_134,motif_length==4),aes(x=motif_geno,y=frac,fill=factor(diff))) +
geom_bar(stat='identity', position = position_stack(reverse = TRUE)) +
theme_cust +
facet_wrap(.~motif_length,scales = "free") +
coord_flip() +
scale_fill_manual(values=c("#E7B800", "#00AFBB","gray69")) +
xlab("Motif")+
ylab("Percent of\nALT alleles (%)")  +
labs(fill="Mutations") +
geom_text(aes(label=count_motif2),y=109,size = 10*5/14) +
scale_y_continuous(breaks=c(0, 50, 100),limits = c(0,113) ) +
theme(legend.position = "none" ,
axis.text.y = ggplot2::element_text(size=10,  color = "black"),)
fig_S5ab <-  cowplot::plot_grid(fig_S5a, fig_S5b,
labels = c('', 'B'),
rel_heights  =  c(1,4),
label_size = 12,
label_fontfamily="Helvetica",
axis = "lr",
align = "v",
nrow = 2)
fig_S5 <-  cowplot::plot_grid(fig_S5ab, fig_S5c,
labels = c('A', 'C'  ),
label_size = 12,
label_fontfamily="Helvetica",
axis = "tb",
nrow = 1)
ggsave(fig_S5, filename = paste( "../figures/Supp_fig5_frac_expansion.png",sep = ""), units = "mm",height = 200, width = 170)
############# Figure  S6    ###############
#          constrained CDS                #
##########################################
###### fig_S6a  ######
pstr_fea <- table_s1_poly %>% dplyr::select(ref_STR,gfeature)
majorAF_ExpectedHe_fea <- majorAF_ExpectedHe %>%
dplyr::left_join(pstr_fea)%>%
dplyr::group_by(gfeature) %>%
dplyr::mutate(id=row_number(),
mean_het=round(mean(hets),digits = 3),
mean_het2=ifelse(id==1,round(mean(hets),digits = 2),NA)) %>%
dplyr::ungroup()
majorAF_ExpectedHe_fea$gfeatures<- factor(majorAF_ExpectedHe_fea$gfeature,levels = c("promoter","enhancer","5'UTR","CDS","intron","3'UTR","pseudogene","RNAs & TEs","intergenic"))
fig_S6a <- ggplot(majorAF_ExpectedHe_fea,aes(x=gfeatures,y=hets))+
geom_violin(width=1.1,size=0.2)+
geom_boxplot(width=0.08, color="black",fill="grey", alpha=0.2,outlier.shape = NA,size=0.2)+
geom_point(aes(x=gfeatures,y=mean_het2),size=0.5,color="red")+
theme_cust +
xlab("Genomic features")+
ylab(expression(italic(H)[E]))+
ylim(0,1) +
theme(axis.text.x =  element_blank(),
axis.title.x= element_blank() ) +
ggpubr::stat_compare_means(label = "p.signif", method = "wilcox.test",label.y = 0.9,  p.adjust.method = "bonferroni",
ref.group = "CDS")
###### fig_S6b  ######
repeat_var <- table_s1_poly %>%
dplyr::select(ref_STR,Chr,start,BPDIFFS,motif_length,gfeature) %>%
dplyr::arrange(Chr,start) %>%
splitstackshape::cSplit("BPDIFFS",",", direction = "long",sep = ",") %>%
dplyr::ungroup() %>%
dplyr::mutate( repeatN_var=abs(BPDIFFS)/motif_length)  %>%
dplyr::group_by(gfeature,ref_STR) %>%
dplyr::mutate(mean_repeatN_var=mean(repeatN_var)) %>%
dplyr::distinct(gfeature,ref_STR,mean_repeatN_var ) %>%
dplyr::group_by(gfeature) %>%
dplyr::mutate(id=row_number(),
gmean_repeatN_var=ifelse(id==1,round(mean(mean_repeatN_var),digits = 2),NA))%>%
dplyr::ungroup()
repeat_var$gfeatures<- factor(repeat_var$gfeature,levels = c("promoter","enhancer","5'UTR","CDS","intron","3'UTR","pseudogene","RNAs & TEs","intergenic"))
#plot
fig_S6b <- ggplot(repeat_var,aes(x=gfeatures,y=mean_repeatN_var))+
geom_violin(width=1.1,size=0.2)+
geom_boxplot(width=0.08, color="black",fill="grey", alpha=0.2,outlier.shape = NA,size=0.2) +
geom_point(aes(x=gfeatures,y=gmean_repeatN_var),size=0.5,color="red") +
theme_cust +
xlab("Genomic features")+
ylab("Mean repeat\nnumber variance") +
theme(axis.text.x =  element_blank(),
axis.title.x= element_blank() ) +
ggpubr::stat_compare_means(label = "p.signif", method = "wilcox.test",label.y = 14,
p.adjust.method = "bonferroni",
symnum.args = list(cutpoints = c(0, 0.0001,0.05,  1),
symbols = c("****","*",  "ns")),
ref.group = "CDS")+
ylim(0,15)
###### fig_S6c  ######
poly_gc <- table_s1_poly  %>%
dplyr::mutate(countA=stringr::str_count(motif_geno, "A"),
countG=stringr::str_count(motif_geno, "G"),
countC=stringr::str_count(motif_geno, "C"),
countT=stringr::str_count(motif_geno, "T"),
contentGC=100*(countG+countC)/(countG+countC+countA+countT)) %>%
dplyr::group_by(gfeature) %>%
dplyr::mutate(id=row_number(),
gmean_gc=ifelse(id==1,round(mean(contentGC),digits = 2),NA)) %>%
dplyr::ungroup()
poly_gc$gfeatures<- factor(poly_gc$gfeature,levels = c("promoter","enhancer","5'UTR","CDS","intron","3'UTR","pseudogene","RNAs & TEs","intergenic"))
#plot
fig_S6c <- ggplot(poly_gc,aes(x=gfeatures,y=contentGC))+
geom_violin(width=1.1,size=0.2)+
geom_boxplot(width=0.08, color="black",fill="grey", alpha=0.2,outlier.shape = NA,size=0.2) +
geom_point(aes(x=gfeatures,y=gmean_gc),size=0.5,color="red") +
theme_cust +
xlab("Genomic features")+
ylab("GC content (%)")+
theme(axis.text.x =  element_text(size=10,   color = "black", angle = 45, hjust = 1)) +
ggpubr::stat_compare_means(label = "p.signif", method = "wilcox.test",label.y = 101,
p.adjust.method = "bonferroni",
symnum.args = list(cutpoints = c(0, 0.00001,0.0001,0.05,  1),
symbols = c("****","***","**",  "ns")),
ref.group = "CDS")+
ylim(0,105)
fig_S6 <-  cowplot::plot_grid(fig_S6a, fig_S6b,fig_S6c,
labels = c('A' ,'B' ,'C'),
rel_heights =  c(1,1,1.5 ),
label_size = 12,
label_fontfamily="Helvetica",
align = "v",
nrow = 3)
ggsave(fig_S6, filename = paste( "../figures/Supp_fig6_constrainedCDS.png",sep = ""), units = "mm",height = 170, width = 170)
############# Figure  S7    ###############
#          MA_pSTR motif enrichment       #
##########################################
data_fig_S7 <- data.table::fread("../processed_data/table_s6_MA_pSTRs.txt")
###### fig_S7a  ######
MAstr_motif_count  <- data_fig_S7 %>%
dplyr::mutate(motif_geno=motif_geno_fwd ) %>%
dplyr::group_by(motif_geno,motif_length) %>%
dplyr::count() %>%
dplyr::ungroup() %>%
dplyr::top_n(10, n)  %>%
dplyr::arrange(  n )
MAstr_motif_count$motif <- factor(MAstr_motif_count$motif_geno, levels = MAstr_motif_count$motif_geno )
fig_S7a <- ggplot(MAstr_motif_count,aes(x=motif,y=n ,fill=factor(motif_length))) +
geom_bar(stat='identity') +
scale_fill_manual(values=period_size_color) +
theme_cust +
coord_flip() +
theme(legend.position = "none") +
labs(y="Number of sites",
x="STR motif") +
scale_y_continuous(breaks=c(0, 300,600) )
###### fig_S7b ######
MASTR_region <- data_fig_S7  %>%
dplyr::group_by(gfeature,motif_length) %>%
dplyr::add_count(name = "STRbyPS_REGION")%>%
dplyr::group_by(gfeature) %>%
dplyr::add_count(name = "STRby_REGION") %>%
dplyr::mutate(ps2region=100*STRbyPS_REGION/STRby_REGION) %>%
dplyr::distinct(gfeature,motif_length,STRbyPS_REGION,STRby_REGION,ps2region) %>%
dplyr::mutate(STRby_REGIONs=ifelse(motif_length==1,STRby_REGION,NA))
MASTR_region$gfeatures<- factor(MASTR_region$gfeature,levels = c("promoter","enhancer","5'UTR","CDS","intron","3'UTR","pseudogene","RNAs & TEs","intergenic"))
#plot
fig_S7b <- ggplot(MASTR_region,aes(x=gfeatures,y=ps2region,fill=factor(motif_length))) +
geom_bar(stat='identity', position = position_stack(reverse = TRUE)) +
coord_flip() +
theme_cust +
xlab("Genomic features")+
ylab("Percent of pSTRs (%)")  +
labs(fill="Motif\nlength")+
scale_fill_manual(values=period_size_color) +
geom_text(aes(label=STRby_REGIONs),y=115,size = 10*5/14)+
scale_y_continuous(breaks=c(0, 50, 100),limits = c(0,125) ) +
theme(legend.position = "left")+
guides(fill = guide_legend(nrow = 6))
###### fig_S7c ######
enrich_MASTR_region_stats <- MASTR_region %>%
dplyr::ungroup() %>%
dplyr::rename(sig_n=STRbyPS_REGION,
sig_total=STRby_REGION) %>%
dplyr::group_by(motif_length) %>%
dplyr::mutate(n=sum(sig_n)) %>%
dplyr::ungroup() %>%
dplyr::mutate(total=sum(sig_n)) %>%
dplyr::group_by(motif_length,gfeature)  %>%
dplyr::do(data.frame(x=fisher_enrich_func(.)))  %>%
dplyr::rename(fisherp = x) %>%
dplyr::ungroup() %>%
dplyr::mutate(fisherp_adj=p.adjust(fisherp,method="bonferroni")) %>%
dplyr::mutate(figure="FIG.S6C") %>%
dplyr::mutate(group_factor="gfeature, motif_length",
group_factor_catogory=paste0(gfeature,  ", ", motif_length),
method="one-sided Fisher's Exact test",
padjustment="BF")
enrich_MASTR_region<-enrich_MASTR_region_stats %>%
dplyr::filter(fisherp_adj<0.05) %>%
dplyr::mutate(logp=-log10(fisherp_adj))
enrich_MASTR_region$gfeatures<- factor(enrich_MASTR_region$gfeature,levels = c("promoter","enhancer","5'UTR","CDS","intron","3'UTR","pseudogene","RNAs & TEs","intergenic"))
fig_S7c <- ggplot(enrich_MASTR_region,
aes(y=gfeatures,x=logp,color=factor(motif_length)))+
ggbeeswarm::geom_beeswarm(cex=2,groupOnX = F)+
theme_cust+
theme( legend.position = "none")+
scale_color_manual(values=period_size_color) +
scale_x_continuous(limits = c(0,100) )   +
ylab("Genomic features")+
xlab(expression(-log[10](italic(p))))
###### fig_S7d ######
enrichMotif_MASTR_region_stats <-  data_fig_S7 %>%
dplyr::mutate(motif_geno=motif_geno_fwd ) %>%
dplyr::group_by(gfeature, motif_geno ) %>%
dplyr::count(name = "sig_n") %>%
dplyr::ungroup() %>%
dplyr::group_by(gfeature) %>%
dplyr::mutate(sig_total=sum(sig_n)) %>%
dplyr::ungroup() %>%
dplyr::group_by( motif_geno) %>%
dplyr::mutate(n=sum(sig_n)) %>%
dplyr::ungroup() %>%
dplyr::mutate(total=sum(sig_n)) %>%
dplyr::group_by( gfeature,motif_geno )  %>%
dplyr::do(data.frame(x=fisher_enrich_func(.)))  %>%
dplyr::rename(fisherp = x) %>%
dplyr::ungroup() %>%
dplyr::mutate(fisherp_adj=p.adjust(fisherp,method="bonferroni"))%>%
dplyr::mutate(figure="FIG.S6C") %>%
dplyr::mutate(group_factor="gfeature, motif_geno",
group_factor_catogory=paste0(gfeature,  ", ", motif_geno),
method="one-sided Fisher's Exact test",
padjustment="BF")
enrichMotif_MASTR_region <- enrichMotif_MASTR_region_stats %>%
dplyr::filter(fisherp_adj<0.05)   %>%
dplyr::mutate(logp=-log10(fisherp_adj)) %>%
dplyr::mutate(motif_length=nchar(motif_geno))%>%
dplyr::arrange(  motif_length )  %>%
dplyr::group_by(gfeature) %>%
dplyr::top_n(3, logp)
enrichMotif_MASTR_region$gfeatures<- factor(enrichMotif_MASTR_region$gfeature,levels = c("promoter","enhancer","5'UTR","CDS","intron","3'UTR","pseudogene","RNAs & TEs","intergenic"))
fig_S7d <- ggplot(enrichMotif_MASTR_region,
aes(y=gfeatures,x=logp,color=factor(motif_length)))+
ggbeeswarm::geom_beeswarm(cex=2,groupOnX = F) +
ggrepel::geom_text_repel(aes(label = motif_geno),  nudge_x = 2,segment.linetype=6, size=10*5/14,
max.overlaps=Inf,
box.padding = 0.5) +
theme_cust+
theme( legend.position = "none") +
scale_color_manual(values=period_size_color) +
ylab("Genomic features")+
xlab(expression(-log[10](italic(p))))
###### fig S7 #####
fig_S7ab <-  cowplot::plot_grid(fig_S7a, fig_S7b,
labels = c('', 'B'),
rel_widths =  c(1.3,2),
label_size = 12,
label_fontfamily="Helvetica",
axis = "t",
nrow = 1)
fig_S7cd <-  cowplot::plot_grid(fig_S7c,fig_S7d,
labels = c('', 'D'),
label_size = 12,
label_fontfamily="Helvetica",
axis = "t",
nrow = 1)
fig_S7 <-  cowplot::plot_grid(fig_S7ab, fig_S7cd,
labels = c('A', 'C'  ),
label_size = 12,
label_fontfamily="Helvetica",
axis = "lr",
nrow = 2)
ggsave(fig_S7, filename = paste( "../figures/Supp_fig7_MAmotif.png",sep = ""), units = "mm",height = 160, width = 170)
############# Figure  S8    ###############
#          MA ps u                       #
##########################################
###### fig_S8  ######
data_fig_S8 <- data_fig_4 %>%
dplyr::filter(motif_length!="1-6" &
motif_geno=="All" &
gfeature=="All" &
OMA=="O1MA")
data_fig_S8_stats <-ggpubr::compare_means( mutation_rate ~ strain,
data= data_fig_S8 ,
group.by = c( "mutation" ,"motif_length"),
p.adjust.method = "bonferroni",
label = "p.signif",
method = "wilcox.test" ) %>%
dplyr::mutate(figure="FIG.S7") %>%
dplyr::select(-p.format,-p.signif) %>%
dplyr::mutate(group_factor="mutation, motif_length",
group_factor_catogory=paste0(mutation,  ", ", motif_length),
method="two-sided Wilcoxon test",
padjustment="BF") %>%
dplyr::select(figure,method,group_factor,group_factor_catogory,'.y.', group1,group2,p,padjustment,p.adj)
fig_S8 <- ggpubr::ggboxplot(data_fig_S8, x="mutation",y="mutation_rate",outlier.shape = NA,
color="strain"  ) +
geom_point( position = position_jitterdodge(jitter.width = 0.2) ,aes(color=strain), size=0.5, alpha=0.8)+
theme_cust +
theme(legend.position = "bottom")+
facet_grid( motif_length~.,scales = "free")+
scale_color_manual(values = c("orange","#007e2f","#ffcd12","#721b3e") ) +
labs(x="Mutations",y="ANC-O1MA mutation rate",color="Strain" ) +
ggpubr::stat_compare_means(
aes(group = strain),
label = "p.signif",
size = 3,
symnum.args = list(cutpoints = c(0, 0.0001, 0.001, 0.01, 1),
symbols = c("****","**","*",  "ns")),
method = "wilcox.test") +
scale_y_continuous(labels = function(x) format(x, scientific = TRUE),expand = c(0.1, 0 ) )
ggsave(fig_S8, filename = paste( "../figures/Supp_fig8_MA_ps_u.png",sep = ""), units = "mm",height = 200, width = 170)
############# Figure  S9    ###############
#          pSTR pxg                      #
##########################################
data_fig_S9 <- data.table::fread("../processed_data/table_s9_Organismal_Lrt_STRs_pxg.txt")
#write.table(data_fig_S9, "../processed_data/fig_s9_Organismal_Lrt_STRs_pxg.txt", sep = "\t", row.names = F, quote = FALSE)
traits_name_df <- data.frame(organismal_trait=c("broods","abamectin_norm.n","arsenic_pc1","Albendazole_q90.TOF",
"bleo_medianEXT","dauer_frac","amsacrine_f.L1","etoposide_median.TOF",
"propionicL1survival","telomere_resids","zinc_norm_EXT"),
trait_name=c("Lifetime fecundity","Response to abamectin","Response to arsenic","Response to albendazole",
"Response to bleomycin","Dauer formation","Response to amsacrine","Response to etoposide",
"Response to propionate","Telomere length","Response to zinc") )
data_fig_S9_N2 <- data_fig_S9 %>%
dplyr::left_join(traits_name_df) %>%
dplyr::group_by(organismal_trait) %>%
dplyr::filter(adjusted_p==min(adjusted_p)) %>%
dplyr::ungroup() %>%
dplyr::group_by(strain) %>%
dplyr::add_count() %>%
dplyr::filter( strain=="N2") %>%
dplyr::select(organismal_trait, pSTR,ref_strain=strain,ref_str_length=STR_length)
data_fig_S9_top <- data_fig_S9 %>%
dplyr::left_join(traits_name_df) %>%
dplyr::group_by(organismal_trait) %>%
dplyr::filter(adjusted_p==min(adjusted_p)) %>%
dplyr::ungroup() %>%
dplyr::left_join(data_fig_S9_N2) %>%
dplyr::mutate(allele=ifelse(is.na(ref_strain) & STR_length==18, "REF",
ifelse(is.na(ref_strain) & STR_length==15, "ALT",
ifelse(ref_str_length==STR_length,"REF","ALT"))) ,
trait_name=paste0(trait_name,"\n",pSTR))
data_fig_S9_top$trait_name2<- factor(data_fig_S9_top$trait_name,levels = c("Lifetime fecundity\nSTR_25031","Dauer formation\nSTR_30772",
"Telomere length\nSTR_10678","Response to abamectin\nSTR_25415",
"Response to albendazole\nSTR_6418","Response to arsenic\nSTR_8043",
"Response to bleomycin\nSTR_31790","Response to amsacrine\nSTR_1102",
"Response to propionate\nSTR_29860"))
fig_S9 <- ggplot(data_fig_S9_top,aes(x=as.factor(STR_length),y=trait_value ))+
geom_jitter(shape=21,position=position_jitter(0.2),aes(fill=as.factor(allele)) ) +
geom_boxplot( outlier.shape = NA,alpha=0.5) +
theme_cust+
ggplot2::scale_fill_manual(values = c("REF"="orange","ALT"="blue") )+
xlab("Length of STR") + ylab("Trait values") +
facet_wrap(.~trait_name2 ,scales = "free",nrow=3) +
theme( legend.position = "none"  )
ggsave(fig_S9, filename = paste( "../figures/Supp_fig9_pxg.png",sep = ""), units = "mm",height =  180, width = 170)
#######
